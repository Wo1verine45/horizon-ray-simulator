# Documento ‚Äì Passo 2

## Arquitetura do Motor de Tra√ßado de Raios

---

## 1. Objetivo do Passo 2

Este documento define a **arquitetura conceitual e computacional** do motor de tra√ßado de raios do simulador. O motor ser√° respons√°vel por calcular, de forma gen√©rica e extens√≠vel, a trajet√≥ria dos raios de luz em diferentes cen√°rios f√≠sicos.

O objetivo central √© criar um n√∫cleo de c√°lculo que seja:

* Independente do modelo geom√©trico (Terra curva ou plana)
* Independente do modelo atmosf√©rico
* Capaz de suportar m√∫ltiplos n√≠veis de complexidade f√≠sica
* Compat√≠vel com m√©todos num√©ricos de integra√ß√£o

Nenhuma visualiza√ß√£o gr√°fica √© considerada neste passo.

---

## 2. Princ√≠pios de Projeto

O motor de tra√ßado de raios dever√° obedecer aos seguintes princ√≠pios:

* **Separa√ß√£o entre f√≠sica e implementa√ß√£o**
* **Modularidade**: novos modelos f√≠sicos n√£o devem exigir reescrita do motor
* **Determinismo**: mesmas condi√ß√µes iniciais produzem sempre os mesmos resultados
* **Transpar√™ncia cient√≠fica**: cada etapa do c√°lculo deve ser rastre√°vel

---

## 3. Representa√ß√£o Fundamental de um Raio

### 3.1 Estado do Raio

Em qualquer instante, um raio √© descrito pelo seguinte conjunto de vari√°veis:

* Posi√ß√£o: ( (x, z) )
* Dire√ß√£o: ( \theta ) (√¢ngulo em rela√ß√£o √† horizontal local)
* Comprimento de arco acumulado: ( s )

Este conjunto define o **estado instant√¢neo do raio**.

---

### 3.2 Vetor Dire√ß√£o

O vetor dire√ß√£o unit√°rio √© dado por:

[
\hat{d} = (\cos \theta, \sin \theta)
]

Este vetor ser√° atualizado continuamente conforme a refra√ß√£o atmosf√©rica.

---

## 4. Ambiente F√≠sico (Environment)

### 4.1 Conceito de Ambiente

O ambiente representa tudo aquilo que influencia a propaga√ß√£o do raio, exceto o pr√≥prio raio.

O ambiente √© respons√°vel por fornecer:

* Geometria da superf√≠cie
* Altura local
* √çndice de refra√ß√£o em fun√ß√£o da posi√ß√£o
* Gradiente do √≠ndice de refra√ß√£o

---

### 4.2 Interface Conceitual do Ambiente

O motor de tra√ßado interage com o ambiente exclusivamente por meio de fun√ß√µes abstratas:

* ( h = get_height(x, z) )
* ( n = get_refractive_index(h) )
* ( \nabla n = get_refractive_gradient(h) )
* ( intersects = surface_intersection(ray) )

üìå Isso garante que o motor n√£o precise conhecer os detalhes internos da Terra curva ou plana.

---

## 5. Modelo de Propaga√ß√£o do Raio

### 5.1 Forma Geral da Evolu√ß√£o

A trajet√≥ria do raio √© calculada como uma **integra√ß√£o incremental ao longo do comprimento de arco**.

Para um pequeno passo ( \Delta s ):

* A posi√ß√£o √© atualizada
* A dire√ß√£o √© atualizada conforme o modelo f√≠sico

---

### 5.2 Equa√ß√µes de Atualiza√ß√£o (Forma Geral)

[
x_{i+1} = x_i + \Delta s \cos \theta_i
]

[
z_{i+1} = z_i + \Delta s \sin \theta_i
]

[
\theta_{i+1} = \theta_i + \Delta \theta
]

Onde ( \Delta \theta ) depende do modelo de refra√ß√£o selecionado.

---

## 6. Modelos de Evolu√ß√£o Angular

### 6.1 Modelo 1 ‚Äì Sem Refra√ß√£o

* ( \Delta \theta = 0 )
* O raio permanece retil√≠neo

---

### 6.2 Modelo 2 ‚Äì Curvatura M√©dia (7/6 R)

* A curvatura do raio √© constante
* ( \Delta \theta = k \cdot \Delta s )
* O valor de ( k ) √© derivado do raio efetivo

Este modelo serve como **baseline cient√≠fico**.

---

### 6.3 Modelo 3 ‚Äì Gradiente Cont√≠nuo Simples

A varia√ß√£o angular √© dada por:

[
\frac{d\theta}{ds} = \frac{1}{n(h)} \frac{dn}{dh}
]

Esta equa√ß√£o ser√° integrada numericamente.

---

### 6.4 Modelo 4 ‚Äì Atmosfera em Camadas

* O espa√ßo vertical √© discretizado em camadas
* Cada camada possui ( n ) aproximadamente constante
* A varia√ß√£o angular √© calculada localmente

M√©todos num√©ricos mais sofisticados poder√£o ser aplicados.

---

## 7. M√©todo Num√©rico de Integra√ß√£o

### 7.1 Integra√ß√£o Incremental

O motor dever√° suportar, no m√≠nimo:

* M√©todo de Euler expl√≠cito

E opcionalmente:

* Runge-Kutta de 4¬™ ordem (RK4)

A escolha do m√©todo ser√° configur√°vel pelo usu√°rio.

---

### 7.2 Tamanho do Passo

* O passo ( \Delta s ) ser√° constante por padr√£o
* Poder√° ser adaptativo em vers√µes futuras

O passo deve ser pequeno o suficiente para garantir estabilidade num√©rica.

---

## 8. Crit√©rios de Parada do Tra√ßado

O tra√ßado de um raio deve ser interrompido quando:

* O raio intersectar a superf√≠cie
* O raio ultrapassar uma dist√¢ncia m√°xima definida
* O raio ultrapassar um limite superior da atmosfera

Esses crit√©rios evitam loops infinitos.

---

## 9. Estrutura de Dados de Sa√≠da

O resultado do tra√ßado de um raio ser√°:

* Uma lista ordenada de estados:

  * ( (x_i, z_i, \theta_i, s_i) )

Essa estrutura permite:

* Visualiza√ß√£o posterior
* An√°lise cient√≠fica
* Compara√ß√£o entre modelos

---

## 10. Valida√ß√£o do Motor de Tra√ßado

O motor ser√° considerado correto se:

* Produzir trajet√≥rias retil√≠neas quando a refra√ß√£o estiver desativada
* Reproduzir curvaturas esperadas no modelo 7/6 R
* Produzir trajet√≥rias suaves e cont√≠nuas
* Apresentar estabilidade num√©rica

---

## 11. Papel do Passo 2 no Projeto

Este motor √© o **n√∫cleo computacional** do simulador. Todas as camadas superiores (atmosfera realista, miragens, visualiza√ß√£o) dependem diretamente da robustez desta arquitetura.

Uma vez validado, o motor **n√£o dever√° ser modificado**, apenas estendido por novos modelos f√≠sicos.

---

**Fim do Documento ‚Äì Passo 2: Arquitetura do Motor de Tra√ßado de Raios**
